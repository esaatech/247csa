{% extends 'base.html' %}
{% load static %}
{% block content %}
<script>
  window.openCsaId = "{{ open_csa_id|default:'' }}";
</script>
<div class="flex h-screen w-full">
<input type="hidden" id="csa_id" value="{{ open_csa_id|default:'' }}">
<input type="hidden" id="chatId" value="7c9e6679-7425-40de-944b-e07fc1f90ae9" />

    <!-- Left Navigation -->
    <div class="w-1/5 min-w-[300px] bg-white p-4 border-r">
        <button 
            id="createButton"
            class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 mb-4"
            hx-get="{% url 'csa:create' %}"
            hx-target="#mainContent"
            hx-swap="innerHTML"
            onclick="clearAgentId()"
        >
            Create CSA
        </button>
        
        <!-- CSA List -->
        <div class="mt-4">
            <h3 class="font-medium mb-2">Your CSAs</h3>
            <div 
                id="csaList"
                hx-get="{% url 'csa:list' %}"
                hx-trigger="load"
                hx-swap="innerHTML"
                class="space-y-2"
            >
                <div class="text-gray-500 text-sm p-2">Loading CSAs...</div>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="flex-1 overflow-auto min-w-0" id="mainContent">
        <!-- Initial welcome content -->
      {% include 'csa/welcome_message.html' %}
    </div>
</div>
{% endblock %}

{% block js_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Initialize Lucide icons
        lucide.createIcons();
    });

    document.body.addEventListener('htmx:afterSwap', function(evt) {
        if (evt.target.id === "mainContent") {
            console.log("HTMX swap detected");
            if (document.querySelector('#createCsaForm')) {
                console.log("calling Init CSA form ");
                removeAllHighlights();
                setTimeout(() => {
                    if (typeof window.initCsaForm === 'function') {
                        window.initCsaForm();
                    }
                }, 100);
            } else if (document.querySelector('#csaDetail')) {
                console.log("calling Init CSA detail");
                if (typeof window.initAgentDetail === "function") {
                    window.initAgentDetail();
                }
            }
        }
    });
document.body.addEventListener('htmx:afterSwap', function(evt) {
    if (evt.target.id === "csaList") {
        console.log("csa list swapped");
        setTimeout(() => {
            const firstItem = document.querySelector('#csaList .csa-item');
            if (firstItem) {
                console.log("clicking first item");
                firstItem.click();
            }
        }, 25);  // Delay by 50ms to allow HTMX hydration
    }
});

// Optional: Also highlight when user clicks manually
  document.body.addEventListener('click', function(evt) {
    if (evt.target.closest('.csa-item')) {
      highlightSelected(evt.target.closest('.csa-item'));
    }
  });

  function highlightSelected(item) {
  document.querySelectorAll('.csa-item').forEach(el => {
    el.classList.remove('bg-blue-100', 'font-semibold');
  });
  item.classList.add('bg-blue-100', 'font-semibold');
}

function removeAllHighlights() {
  document.querySelectorAll('.csa-item').forEach(el => {
    el.classList.remove('bg-blue-100', 'font-semibold');
  });
}


</script>

{% endblock %}
